name: Run Workflows Sequentially

on:
  workflow_dispatch:  # 允许手动触发
  schedule:
    - cron: '*/20 * * * *'  # 每20分钟运行一次

jobs:
  run_workflows:
    runs-on: ubuntu-latest
    steps:
      - name: Run AdBlock Rule Generator YAML
        uses: convictional/trigger-workflow-and-wait@v1.6.1
        with:
          owner: ${{ github.repository_owner }}
          repo: ${{ github.event.repository.name }}
          github_token: ${{ secrets.TOKEN }}
          workflow_file_name: Run_AdBlock_Rule_Generator_YAML.yml
          wait_interval: 10
          propagate_failure: true
          trigger_workflow: true
          wait_workflow: true

      - name: Run AdBlock Rule Generator TXT
        uses: convictional/trigger-workflow-and-wait@v1.6.1
        with:
          owner: ${{ github.repository_owner }}
          repo: ${{ github.event.repository.name }}
          github_token: ${{ secrets.TOKEN }}
          workflow_file_name: Run_AdBlock_Rule_Generator_TXT.yml
          wait_interval: 10
          propagate_failure: true
          trigger_workflow: true
          wait_workflow: true

      - name: Convert Ruleset YAML to MRS
        uses: convictional/trigger-workflow-and-wait@v1.6.1
        with:
          owner: ${{ github.repository_owner }}
          repo: ${{ github.event.repository.name }}
          github_token: ${{ secrets.TOKEN }}
          workflow_file_name: Convert_Ruleset_YAML_to_MRS.yml
          wait_interval: 10
          propagate_failure: true
          trigger_workflow: true
          wait_workflow: true

      - name: Generate Matcher Ruleset entries (CLASH)
        uses: convictional/trigger-workflow-and-wait@v1.6.1
        with:
          owner: ${{ github.repository_owner }}
          repo: ${{ github.event.repository.name }}
          github_token: ${{ secrets.TOKEN }}
          workflow_file_name: Generate_Matcher_Ruleset_entries_CLASH.yml
          wait_interval: 10
          propagate_failure: true
          trigger_workflow: true
          wait_workflow: true

      - name: Generate Matcher Ruleset entries (SURGE)
        uses: convictional/trigger-workflow-and-wait@v1.6.1
        with:
          owner: ${{ github.repository_owner }}
          repo: ${{ github.event.repository.name }}
          github_token: ${{ secrets.TOKEN }}
          workflow_file_name: Generate_Matcher_Ruleset_entries_SURGE.yml
          wait_interval: 10
          propagate_failure: true
          trigger_workflow: true
          wait_workflow: true

      - name: Release Adblock file
        uses: convictional/trigger-workflow-and-wait@v1.6.1
        with:
          owner: ${{ github.repository_owner }}
          repo: ${{ github.event.repository.name }}
          github_token: ${{ secrets.TOKEN }}
          workflow_file_name: Release_ADblock_file.yml
          wait_interval: 10
          propagate_failure: true
          trigger_workflow: true
          wait_workflow: true
